{% extends "base.html" %}
{% load static %}

{% block title %}Στοιχεία Υπηρεσίας Στρατιωτών{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/posta.css' %}">
{% endblock %}

{% block content %}
<div class="video-background">
    <video autoplay muted loop>
        <source src="{% static 'img/index_back.webm' %}" type="video/webm">
    </video>
</div>

<div class="main-content">
    <h1>Στοιχεία Υπηρεσίας Στρατιωτών</h1>

    <!-- Πίνακας Στοιχείων Στρατιωτών -->
    <fieldset class="fieldset-container">
        <legend onclick="toggleFieldset(this)">Πίνακας Στοιχείων</legend>
        <div class="category-content">
            <table id="soldier-table">
                <thead>
                    <tr>
                        <th>Α/Α</th>
                        <th>Στοιχεία Στρατιώτη</th>
                        <th>Πόστο</th>
                        <th>Υπηρεσιακό</th>
                        <th>Διανυκτέρευση</th>
                        <th>Μεταβολές / Υπηρεσίες</th>
                        <th>Διάρκεια</th>
                        <th>Από</th>
                        <th>Έως</th>
                        <th>Καθαριότητες</th>
                    </tr>
                </thead>
                <tbody>
                    {% for soldier in soldiers %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ soldier.vathmos }} {{ soldier.eponymo }} {{ soldier.onoma }}</td>
                        <td>{{ soldier.posto }}</td>
                        <td><input type="text" placeholder="Υπηρεσιακό" name="ypiresiako" /></td>
                        <td><input type="text" placeholder="Διανυκτέρευση" name="dianyktereysi" /></td>
                        <td>
                            <select>
                                <option value="">Επιλέξτε</option>
                                <option>Απόσπαση</option>
                                <option>Κανονική Άδεια</option>
                                <option>Τιμητική Άδεια</option>
                                <option>Αγροτική Άδεια</option>
                                <option>Αναρρωτική Άδεια</option>
                                <option>Φοιτητική Άδεια</option>
                                <option>Άδεια Ορκομωσίας</option>
                                <option>Αιμοδοτική Άδεια</option>
                                <option>ΕΥ</option>
                                <option>Υπηρεσιακό</option>
                            </select>
                        </td>
                        <td><input type="text" placeholder="Διάρκεια" name="diarkeia" /></td>
                        <td><input type="text" placeholder="Από" name="apo" /></td>
                        <td><input type="text" placeholder="Έως" name="eos" /></td>
                        <td>
                            <select>
                                <option value="">Επιλέξτε</option>
                                <option>ΚΕΠΙΚ-Αξιωματικών</option>
                                <option>ΥΕΣΑ</option>
                                <option>Helpdesk</option>
                                <option>Διάδρομος-Τουαλέτες</option>
                            </select>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </fieldset>

    <div class="tables-container">
        <fieldset class="fieldset-container">
            <legend onclick="toggleFieldset(this)">Γενικά Στοιχεία Λόχου</legend>
            <div class="category-content">
                <table id="general-info">
                    <tr>
                        <td>Δύναμη 1ου Λόχου</td>
                        <td id="dynamis_lochou">0</td>
                    </tr>
                    <tr>
                        <td>Απουσίες</td>
                        <td id="apousies">0</td>
                    </tr>
                    <tr>
                        <td>Παρουσίες</td>
                        <td id="parousies">0</td>
                    </tr>
                </table>
            </div>
        </fieldset>
    
        <fieldset class="fieldset-container">
            <legend onclick="toggleFieldset(this)">Ειδικά Στοιχεία Λόχου</legend>
            <div class="category-content">
                <table id="special-info">
                    <tr>
                        <td>Τιμητικές Άδειες</td>
                        <td id="timitikes">0</td>
                    </tr>
                    <tr>
                        <td>Λοιπές Άδειες</td>
                        <td id="loipes_adeies">0</td>
                    </tr>
                    <tr>
                        <td>Υπηρεσιακά</td>
                        <td id="ypiresiaka">0</td>
                    </tr>
                    <tr>
                        <td>Απόσπαση</td>
                        <td id="apospathseis">0</td>
                    </tr>
                    <tr>
                        <td>ΕΥ</td>
                        <td id="ey">0</td>
                    </tr>
                    <tr>
                        <td>Σύνολο</td>
                        <td id="synolo">0</td>
                    </tr>
                </table>
            </div>
        </fieldset>
    </div>
    
    <fieldset class="fieldset-container">
        <legend onclick="toggleFieldset(this)">Κατάσταση Εξοδούχων</legend>
        <div class="category-content">
            <table id="exodouxoi-table">
                <thead>
                    <tr>
                        <th>Α/Α</th>
                        <th>Στοιχεία Στρατιώτη</th>
                        <th>Υπηρεσιακό</th>
                        <th>Διανυκτέρευση</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Στοιχεία θα συμπληρωθούν από το JS -->
                </tbody>
            </table>
        </div>
    </fieldset>    

    <fieldset class="fieldset-container">
        <legend>Κατάσταση Αδειούχων</legend>
        <div class="category-content">
            <table id="adeiouxoi-table">
                <thead>
                    <tr>
                        <th>Α/Α</th>
                        <th>Στοιχεία Στρατιώτη</th>
                        <th>Είδος Άδειας</th>
                        <th>Από</th>
                        <th>Έως</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Τα δεδομένα θα προστεθούν μέσω του JS -->
                </tbody>
            </table>
        </div>
    </fieldset>

    
    <fieldset class="fieldset-container">
        <legend>Κατάσταση Τιμητικών Αδειούχων</legend>
        <div class="category-content">
            <table id="timitikes-table">
                <thead>
                    <tr>
                        <th>Α/Α</th>
                        <th>Στοιχεία Στρατιώτη</th>
                        <th>Είδος Άδειας</th>
                        <th>Διάρκεια</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Στοιχεία θα συμπληρωθούν από το JS -->
                </tbody>
            </table>
        </div>
    </fieldset>
    
    <fieldset class="fieldset-container">
        <legend>Ειδικές Περιπτώσεις</legend>
        <div class="category-content">
            <table id="special-cases-table">
                <thead>
                    <tr>
                        <th>Α/Α</th>
                        <th>Στοιχεία Στρατιώτη</th>
                        <th>Είδος Άδειας</th>
                        <th>Διάρκεια</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Στοιχεία θα συμπληρωθούν από το JS -->
                </tbody>
            </table>
        </div>
    </fieldset>
    
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Function to calculate absences and present soldiers
        function calculateAbsencesAndPresent() {
            const rows = document.querySelectorAll("#soldier-table tbody tr").length;
            document.getElementById('dynamis_lochou').textContent = rows;

            // Μετρούμε τις απουσίες από τις Μεταβολές / Υπηρεσίες
            const serviceSelects = document.querySelectorAll("#soldier-table select");
            let absences = 0, timitikes = 0, loipesAdeies = 0, ypiresiaka = 0, apospathseis = 0, ey = 0;
            const absenceKeywords = ["Απόσπαση", "Κανονική Άδεια", "Τιμητική Άδεια", "Αγροτική Άδεια", "Αναρρωτική Άδεια", "Φοιτητική Άδεια", "Άδεια Ορκομωσίας", "Αιμοδοτική Άδεια", "Υπηρεσιακό"];
            const timitikesKeywords = ["Τιμητική Άδεια"];
            const loipesAdeiesKeywords = ["Κανονική Άδεια", "Αγροτική Άδεια", "Αναρρωτική Άδεια", "Φοιτητική Άδεια", "Άδεια Ορκομωσίας", "Αιμοδοτική Άδεια"];
            const ypiresiakaKeywords = ["Υπηρεσιακό"];
            const apospathseisKeywords = ["Απόσπαση"];
            const eyKeywords = ["ΕΥ"];

            serviceSelects.forEach(function (select) {
                if (absenceKeywords.includes(select.value)) {
                    absences++;
                }
                if (timitikesKeywords.includes(select.value)) {
                    timitikes++;
                }
                if (loipesAdeiesKeywords.includes(select.value)) {
                    loipesAdeies++;
                }
                if (ypiresiakaKeywords.includes(select.value)) {
                    ypiresiaka++;
                }
                if (apospathseisKeywords.includes(select.value)) {
                    apospathseis++;
                }
                if (eyKeywords.includes(select.value)) {
                    ey++;
                }
            });

            document.getElementById('apousies').textContent = absences;
            document.getElementById('timitikes').textContent = timitikes;
            document.getElementById('loipes_adeies').textContent = loipesAdeies;
            document.getElementById('ypiresiaka').textContent = ypiresiaka;
            document.getElementById('apospathseis').textContent = apospathseis;
            document.getElementById('ey').textContent = ey;
            document.getElementById('synolo').textContent = timitikes + loipesAdeies + ypiresiaka + apospathseis + ey;

            // Υπολογισμός παρουσιών (Δύναμη - Απουσίες)
            const presentCount = rows - absences;
            document.getElementById('parousies').textContent = presentCount;
        }

        // Function to update the "Κατάσταση Εξοδούχων" table
        function updateExodouxoiTable() {
            const soldierRows = document.querySelectorAll("#soldier-table tbody tr");
            const exodouxoiTableBody = document.querySelector("#exodouxoi-table tbody");
            exodouxoiTableBody.innerHTML = ''; // Καθαρίζουμε τον πίνακα

            let counter = 1;
            soldierRows.forEach(function (row) {
                const soldierDetails = row.querySelector('td:nth-child(2)').textContent; // Στοιχεία Στρατιώτη
                const yp = row.querySelector('input[name="ypiresiako"]').value;
                const di = row.querySelector('input[name="dianyktereysi"]').value;

                if (yp.trim() !== '' && di.trim() !== '') {  // Ελέγχουμε αν και τα δύο πεδία είναι συμπληρωμένα
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td>${counter++}</td>
                        <td>${soldierDetails}</td>
                        <td>${yp}</td>
                        <td>${di}</td>
                    `;
                    exodouxoiTableBody.appendChild(newRow);
                }
            });
        }

        // Function to update the "Κατάσταση Αδειούχων" table
        function updateAdeiouxoiTable() {
            const soldierRows = document.querySelectorAll("#soldier-table tbody tr");
            const adeiouxoiTableBody = document.querySelector("#adeiouxoi-table tbody");
            adeiouxoiTableBody.innerHTML = ''; // Καθαρίζουμε τον πίνακα

            const validLeaveTypes = ["Κανονική Άδεια", "Αγροτική Άδεια", "Αιμοδοτική Άδεια", "Αναρρωτική Άδεια", "Φοιτητική Άδεια"];
            let counter = 1;

            soldierRows.forEach(function (row) {
                const soldierDetails = row.querySelector('td:nth-child(2)').textContent; // Στοιχεία Στρατιώτη
                const leaveType = row.querySelector('select').value;
                const apo = row.querySelector('input[name="apo"]').value;
                const eos = row.querySelector('input[name="eos"]').value;

                if (validLeaveTypes.includes(leaveType)) {  // Ελέγχουμε αν το είδος άδειας είναι ένα από τα έγκυρα
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td>${counter++}</td>
                        <td>${soldierDetails}</td>
                        <td>${leaveType}</td>
                        <td>${apo}</td>
                        <td>${eos}</td>
                    `;
                    adeiouxoiTableBody.appendChild(newRow);
                }
            });
        }

        // Function to update the "Κατάσταση Τιμητικών Αδειούχων" table
        function updateTimitikonAdeiouxonTable() {
            const soldierRows = document.querySelectorAll("#soldier-table tbody tr");
            const timitikoiAdeiouxoiTableBody = document.querySelector("#timitikon-adeiouxon-table tbody");
            timitikoiAdeiouxoiTableBody.innerHTML = ''; // Καθαρίζουμε τον πίνακα

            const validLeaveTypes = ["Τιμητική Άδεια", "Άδεια Ορκομωσίας"];
            let counter = 1;

            soldierRows.forEach(function (row) {
                const soldierDetails = row.querySelector('td:nth-child(2)').textContent; // Στοιχεία Στρατιώτη
                const leaveType = row.querySelector('select').value;
                const diarkeia = row.querySelector('input[name="diarkeia"]').value;

                if (validLeaveTypes.includes(leaveType)) {  // Ελέγχουμε αν το είδος άδειας είναι Τιμητική ή Ορκομωσίας
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td>${counter++}</td>
                        <td>${soldierDetails}</td>
                        <td>${leaveType}</td>
                        <td>${diarkeia}</td>
                    `;
                    timitikoiAdeiouxoiTableBody.appendChild(newRow);
                }
            });
        }

        // Function to update the "Ειδικές Περιπτώσεις" table
        function updateEidikesPeriptoseisTable() {
            const soldierRows = document.querySelectorAll("#soldier-table tbody tr");
            const eidikesPeriptoseisTableBody = document.querySelector("#eidikes-periptoseis-table tbody");
            eidikesPeriptoseisTableBody.innerHTML = ''; // Καθαρίζουμε τον πίνακα

            const validLeaveTypes = ["Απόσπαση", "ΕΥ"];
            let counter = 1;

            soldierRows.forEach(function (row) {
                const soldierDetails = row.querySelector('td:nth-child(2)').textContent; // Στοιχεία Στρατιώτη
                const leaveType = row.querySelector('select').value;
                const diarkeia = row.querySelector('input[name="diarkeia"]').value;

                if (validLeaveTypes.includes(leaveType)) {  // Ελέγχουμε αν το είδος άδειας είναι Απόσπαση ή ΕΥ
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td>${counter++}</td>
                        <td>${soldierDetails}</td>
                        <td>${leaveType}</td>
                        <td>${diarkeia}</td>
                    `;
                    eidikesPeriptoseisTableBody.appendChild(newRow);
                }
            });
        }

        // Αρχικός υπολογισμός
        calculateAbsencesAndPresent();

        // Προσθέτουμε event listener για να παρακολουθούμε τις αλλαγές στα dropdowns
        const serviceSelects = document.querySelectorAll("#soldier-table select");
        serviceSelects.forEach(function (select) {
            select.addEventListener('change', function () {
                calculateAbsencesAndPresent();
                updateExodouxoiTable(); // Κλήση για ενημέρωση των εξοδούχων
                updateAdeiouxoiTable(); // Κλήση για ενημέρωση των αδειούχων
                updateTimitikonAdeiouxonTable(); // Κλήση για ενημέρωση των τιμητικών αδειούχων
                updateEidikesPeriptoseisTable(); // Κλήση για ενημέρωση των ειδικών περιπτώσεων
            });
        });

        // Προσθέτουμε event listener για τις αλλαγές στα πεδία "Υπηρεσιακό", "Διανυκτέρευση", "Από", "Έως"
        const inputs = document.querySelectorAll("#soldier-table input[type='text']");
        inputs.forEach(function (input) {
            input.addEventListener('input', function () {
                updateExodouxoiTable();
                updateAdeiouxoiTable();
                updateTimitikonAdeiouxonTable();
                updateEidikesPeriptoseisTable();
            });
        });

        // Αρχική κλήση για την ενημέρωση των πινάκων
        updateExodouxoiTable();
        updateAdeiouxoiTable();
        updateTimitikonAdeiouxonTable();
        updateEidikesPeriptoseisTable();
    });
</script>


{% endblock %}
