{% extends 'base.html' %}
{% load static %}

{% block title %}Posta - Καταχωρήσεις Στρατιωτών{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/passwords.css' %}">
    <style>
        .fieldset-container legend {
            cursor: pointer;
        }
        .fieldset-content {
            display: none; /* Απόκρυψη κατά την αρχική φόρτωση */
        }
        .search-container {
            text-align: center;
            margin-bottom: 20px;
        }
        #search {
            width: 70%;
            padding: 10px;
            font-size: 1.2em;
            border-radius: 25px;
            border: 1px solid #ccc;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            outline: none;
        }
        #resultsList {
            list-style-type: none;
            background-color: #fff;
            border: 1px solid #ccc;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            position: absolute;
            width: 70%;
            z-index: 9999;
            display: none;
        }
        #resultsList li {
            padding: 10px;
            border-bottom: 1px solid #ccc;
            cursor: pointer;
        }
        #resultsList li:hover {
            background-color: #f0f0f0;
        }
    </style>
{% endblock %}

{% block content %}
<div class="video-background">
    <video autoplay muted loop>
        <source src="{% static 'img/index_back.webm' %}" type="video/webm">
    </video>
</div>

<div class="main-content">
    <h1>Κωδικοί ΑΞΥΠ</h1>

    <div class="search-container">
        <input type="text" id="search" placeholder="Αναζήτηση..." onkeyup="searchTable()">
        <ul id="resultsList"></ul>
    </div>
    
    <!-- Υπολογιστές -->
    <fieldset class="fieldset-container">
        <legend onclick="toggleFieldset(this)">Υπολογιστές</legend>
        <div class="fieldset-content">
            <table>
                <thead>
                    <tr>
                        <th>Server/PC</th>
                        <th>Username</th>
                        <th>Password</th>
                        <th>Παρατηρήσεις</th>
                    </tr>
                </thead>
                <tbody>
                    {% for code in computers %}
                    <tr>
                        <td>{{ code.server_pc }}</td>
                        <td>{{ code.username }}</td>
                        <td>{{ code.password }}</td>
                        <td>{{ code.notes }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </fieldset>

    <!-- Πυρσεία -->
    <fieldset class="fieldset-container">
        <legend onclick="toggleFieldset(this)">Πυρσεία</legend>
        <div class="fieldset-content">
            <table>
                <thead>
                    <tr>
                        <th>Server/PC</th>
                        <th>Username</th>
                        <th>Password</th>
                        <th>Παρατηρήσεις</th>
                    </tr>
                </thead>
                <tbody>
                    {% for code in pyrseia %}
                    <tr>
                        <td>{{ code.server_pc }}</td>
                        <td>{{ code.username }}</td>
                        <td>{{ code.password }}</td>
                        <td>{{ code.notes }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </fieldset>

    <!-- Λοιπές Εφαρμογές -->
    <fieldset class="fieldset-container">
        <legend onclick="toggleFieldset(this)">Λοιπές Εφαρμογές</legend>
        <div class="fieldset-content">
            <table>
                <thead>
                    <tr>
                        <th>Server/PC</th>
                        <th>Username</th>
                        <th>Password</th>
                        <th>Παρατηρήσεις</th>
                    </tr>
                </thead>
                <tbody>
                    {% for code in applications %}
                    <tr>
                        <td>{{ code.server_pc }}</td>
                        <td>{{ code.username }}</td>
                        <td>{{ code.password }}</td>
                        <td>{{ code.notes }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </fieldset>

    <!-- Στελέχη -->
    <fieldset class="fieldset-container">
        <legend onclick="toggleFieldset(this)">Στελέχη</legend>
        <div class="fieldset-content">
            <table>
                <thead>
                    <tr>
                        <th>Επώνυμο</th>
                        <th>Όνομα</th>
                        <th>Πόστο</th>
                    </tr>
                </thead>
                <tbody>
                    {% for code in staff %}
                    <tr>
                        <td>{{ code.last_name }}</td>
                        <td>{{ code.first_name }}</td>
                        <td>{{ code.position }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </fieldset>

    <!-- Χρήσιμα Τηλέφωνα -->
    <fieldset class="fieldset-container">
        <legend onclick="toggleFieldset(this)">Χρήσιμα Τηλέφωνα</legend>
        <div class="fieldset-content">
            <table>
                <thead>
                    <tr>
                        <th>Περιγραφή</th>
                        <th>Τηλέφωνο Επικοινωνίας</th>
                        <th>Παρατηρήσεις</th>
                    </tr>
                </thead>
                <tbody>
                    {% for code in useful_phones %}
                    <tr>
                        <td>{{ code.description }}</td>
                        <td>{{ code.contact_phone }}</td>
                        <td>{{ code.notes }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </fieldset>

    <!-- Κωδικοί Λειτουργίας Τηλεφώνου -->
    <fieldset class="fieldset-container">
        <legend onclick="toggleFieldset(this)">Κωδικοί Λειτουργίας Τηλεφώνου</legend>
        <div class="fieldset-content">
            <table>
                <thead>
                    <tr>
                        <th>Κωδικός</th>
                        <th>Λειτουργία</th>
                        <th>Παρατηρήσεις</th>
                    </tr>
                </thead>
                <tbody>
                    {% for code in phone_codes %}
                    <tr>
                        <td>{{ code.phone_code }}</td>
                        <td>{{ code.phone_function }}</td>
                        <td>{{ code.notes }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </fieldset>

</div>

<script>
    const searchInput = document.getElementById('search');
    const resultsList = document.getElementById('resultsList');

    // Αναζήτηση στον πίνακα και εμφάνιση αποτελεσμάτων
    searchInput.addEventListener('input', function () {
        searchTable();
    });

    // Αναζήτηση και απόκρυψη dropdown όταν είναι άδειο
    function searchTable() {
        const searchValue = searchInput.value.toLowerCase();
        resultsList.innerHTML = "";  // Καθαρίζουμε τα αποτελέσματα
        let resultsFound = false;

        const tables = document.querySelectorAll("table");
        tables.forEach(table => {
            const rows = table.getElementsByTagName("tr");
            for (let i = 1; i < rows.length; i++) {  // Αγνοούμε την κεφαλίδα
                let rowText = rows[i].innerText.toLowerCase();
                if (rowText.includes(searchValue)) {
                    resultsFound = true;
                    const resultItem = document.createElement("li");
                    resultItem.textContent = rows[i].innerText;
                    resultItem.onclick = function () {
                        rows[i].scrollIntoView({ behavior: 'smooth' });
                        resultsList.style.display = 'none';  // Απόκρυψη λίστας μετά την επιλογή
                    };
                    resultsList.appendChild(resultItem);
                }
            }
        });

        resultsList.style.display = resultsFound ? "block" : "none";
    }

    // Toggle λειτουργία για τα fieldsets
    function toggleFieldset(legendElement) {
        const fieldsetContent = legendElement.nextElementSibling;
        fieldsetContent.style.display = fieldsetContent.style.display === "none" ? "block" : "none";
    }

    // Κλείσιμο της αναζήτησης με το πλήκτρο Escape
    searchInput.addEventListener('keydown', function (event) {
        if (event.key === "Escape") {
            resultsList.style.display = 'none';
        }
    });

    // Απόκρυψη όλων των fieldsets κατά την αρχική φόρτωση
    document.addEventListener('DOMContentLoaded', function () {
        const fieldsets = document.querySelectorAll('.fieldset-content');
        fieldsets.forEach(fieldset => {
            fieldset.style.display = 'none';  // Απόκρυψη όλων των πεδίων
        });
    });
</script>

{% endblock %}
